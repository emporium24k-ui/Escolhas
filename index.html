<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Escolhas — Emporium24k</title>

<style>
:root{
  --bg:#000;
  --text:#f4f4f6;
  --border:rgba(255,255,255,.14);
  --panel:rgba(255,255,255,.03);
  --radius:18px;
  --gap:12px;

  /* dourado escuro chamativo */
  --gold1:#e2b84a;
  --gold2:#b88a1b;
  --goldBorder:#f2d37a;
  --goldText:#0b0b0d;
  --glow: rgba(184,138,27,.45);
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  padding:14px;
}
.wrap{max-width:1180px;margin:0 auto}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  grid-template-areas:
    "top1 top2 top3"
    "bot1 bot2 bot3";
  gap:var(--gap);
  align-items:start;
}
.grid.twoCols{
  grid-template-columns:repeat(2,1fr);
  grid-template-areas:
    "top1 top3"
    "bot1 bot3";
}
.grid.centerOnly{
  grid-template-columns:1fr;
  grid-template-areas:
    "top2"
    "bot2";
}

.panel{
  border:1px solid var(--border);
  border-radius:var(--radius);
  background:var(--panel);
  overflow:hidden;
}
.hidden{display:none!important;}

.mediaPanel{position:relative; min-height:220px;}

/* ✅ FIX: imagem nunca estoura */
.media{
  min-height:220px;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:10px;
}
.media img{
  display:block;
  max-width:100%;
  max-height:58vh;
  width:auto;
  height:auto;
  object-fit:contain;
}

.caption{
  display:none; /* mobile usa */
  padding:14px 14px 18px 14px;
  border-top:1px solid rgba(255,255,255,.10);
  font-size:18px; line-height:1.35;
}

.choiceBtn{
  position:absolute;
  left:12px; right:12px; bottom:12px;
  padding:14px;
  border-radius:14px;
  background:linear-gradient(180deg,var(--gold1),var(--gold2));
  color:var(--goldText);
  border:1px solid var(--goldBorder);
  box-shadow:0 10px 28px rgba(0,0,0,.65), 0 0 28px var(--glow);
  font-weight:950;
  text-transform:uppercase;
  text-align:center;
  cursor:pointer;
  user-select:none;
}
.choiceBtn:hover{filter:brightness(1.06)}
.choiceBtn:active{transform:translateY(2px)}

.textPanel{padding:16px}
.textPanel .slot{margin:0;font-size:18px;line-height:1.35}

.bigLabel{font-size:22px;font-weight:900}
.centerText{text-align:center;font-size:20px;font-weight:900}
.smallHint{opacity:.85;font-size:16px}

/* ✅ botões de escolha embaixo (pra não sumir quando top1/top3 escondem) */
.bottomChoice{
  display:flex;
  align-items:center;
  justify-content:center;
  width:100%;
  padding:18px 14px;
  border-radius:14px;
  background:linear-gradient(180deg,var(--gold1),var(--gold2));
  color:var(--goldText);
  border:1px solid var(--goldBorder);
  box-shadow:0 10px 28px rgba(0,0,0,.65), 0 0 28px var(--glow);
  font-weight:950;
  text-transform:uppercase;
  cursor:pointer;
  user-select:none;
}
.bottomChoice:hover{filter:brightness(1.06)}
.bottomChoice:active{transform:translateY(2px)}

/* grid areas */
#top1{grid-area:top1}
#top2{grid-area:top2}
#top3{grid-area:top3}
#bot1{grid-area:bot1}
#bot2{grid-area:bot2}
#bot3{grid-area:bot3}

/* PDF ocupa topo todo */
.pdfFull{
  grid-area:top1 / top1 / top3 / top3;
  border:1px solid var(--border);
  border-radius:var(--radius);
  position:relative;
  overflow:hidden;
  min-height:70vh;
  background:#000;
}
.pdfFull iframe{
  width:100%;
  height:70vh;
  border:0;
  background:#000;
}
.pdfAction{
  position:absolute;
  top:14px;
  padding:14px 18px;
  border-radius:14px;
  background:linear-gradient(180deg,var(--gold1),var(--gold2));
  color:var(--goldText);
  border:1px solid var(--goldBorder);
  font-weight:950;
  cursor:pointer;
  user-select:none;
  z-index:10;
}
.pdfAction.left{left:14px}
.pdfAction.right{right:14px}

/* MOBILE */
@media (max-width:900px){
  body{padding:10px}
  .grid, .grid.twoCols, .grid.centerOnly{
    grid-template-columns:1fr;
    grid-template-areas:
      "top1"
      "top2"
      "top3"
      "bot1"
      "bot2"
      "bot3";
  }
  .mediaPanel{min-height:260px;}
  .media{min-height:260px;}
  .media img{max-height:52vh;}
  .caption{display:block;}
  .textPanel{padding:14px}
  .pdfFull{min-height:78vh;}
  .pdfFull iframe{height:78vh;}
  .pdfAction{padding:16px 16px;font-size:16px;border-radius:16px}
  .pdfAction.left{left:10px}
  .pdfAction.right{right:10px}
}
</style>
</head>

<body>
<div class="wrap">
  <div class="grid" id="grid">

    <div class="panel mediaPanel" id="top1">
      <div class="media"><img id="top1img" alt=""></div>
      <div class="caption" id="cap1"></div>
      <div class="choiceBtn" id="top1btn"></div>
    </div>

    <div class="panel mediaPanel" id="top2">
      <div class="media"><img id="top2img" alt=""></div>
      <div class="caption" id="cap2"></div>
      <div class="choiceBtn" id="top2btn"></div>
    </div>

    <div class="panel mediaPanel" id="top3">
      <div class="media"><img id="top3img" alt=""></div>
      <div class="caption" id="cap3"></div>
      <div class="choiceBtn" id="top3btn"></div>
    </div>

    <div class="pdfFull hidden" id="pdfWrap">
      <div class="pdfAction left" id="pdfBack">voltar</div>
      <div class="pdfAction right" id="pdfWhats">chamar no whatsapp</div>
      <iframe id="pdfFrame" title="PDF"></iframe>
    </div>

    <div class="panel textPanel" id="bot1"><div class="slot" id="bot1slot"></div></div>
    <div class="panel textPanel" id="bot2"><div class="slot" id="bot2slot"></div></div>
    <div class="panel textPanel" id="bot3"><div class="slot" id="bot3slot"></div></div>

  </div>
</div>

<script>
/* =========================
   CONFIG
========================= */
const TIMER_MS = 60000; // 60s (exceto PDF)
const WHATS = "https://wa.me/5541998518452";

let PDFJS_VIEWER = null;
const PDFJS_VIEWER_CANDIDATES = [
  "./viewer.html",
  "./pdfjs/web/viewer.html",
  "./web/viewer.html",
  "./pdfjs/viewer.html"
];

/* =========================
   DOM
========================= */
const grid = document.getElementById("grid");

const top1 = document.getElementById("top1");
const top2 = document.getElementById("top2");
const top3 = document.getElementById("top3");

const t1 = document.getElementById("top1img");
const t2 = document.getElementById("top2img");
const t3 = document.getElementById("top3img");

const b1 = document.getElementById("top1btn");
const b2 = document.getElementById("top2btn");
const b3 = document.getElementById("top3btn");

const cap1 = document.getElementById("cap1");
const cap2 = document.getElementById("cap2");
const cap3 = document.getElementById("cap3");

const bot1slot = document.getElementById("bot1slot");
const bot2slot = document.getElementById("bot2slot");
const bot3slot = document.getElementById("bot3slot");

const bot1Panel = document.getElementById("bot1");
const bot2Panel = document.getElementById("bot2");
const bot3Panel = document.getElementById("bot3");

const pdfWrap = document.getElementById("pdfWrap");
const pdfFrame = document.getElementById("pdfFrame");
const pdfBack = document.getElementById("pdfBack");
const pdfWhats = document.getElementById("pdfWhats");

let timer = null;

/* =========================
   HELPERS
========================= */
function clearT(){ if(timer) clearTimeout(timer); timer=null; }
function startT(fn){ clearT(); timer=setTimeout(fn, TIMER_MS); }

function show(el){ el.classList.remove("hidden"); }
function hide(el){ el.classList.add("hidden"); }

function setGridMode(mode){
  grid.classList.remove("twoCols","centerOnly");
  if(mode==="two") grid.classList.add("twoCols");
  if(mode==="center") grid.classList.add("centerOnly");
}

function img(name){
  return (name==="03") ? "./03.jpeg" : "./"+name+".png";
}

function setImg(imgEl, src){
  imgEl.onerror = () => { imgEl.style.display="none"; };
  imgEl.style.display="block";
  imgEl.src = src || "";
}

function setTopBtn(btnEl, label, fn){
  btnEl.onclick = null;
  if(!label){
    btnEl.textContent="";
    btnEl.classList.add("hidden");
    return;
  }
  btnEl.classList.remove("hidden");
  btnEl.textContent = label;
  btnEl.onclick = fn;
}

function setBottomHTML(slotEl, html){
  slotEl.innerHTML = html || "";
}
function setBottomButton(slotEl, label, fn){
  slotEl.innerHTML = "";
  const div = document.createElement("div");
  div.className = "bottomChoice";
  div.textContent = label.toUpperCase();
  div.onclick = fn;
  slotEl.appendChild(div);
}

function resetAll(){
  clearT();

  hide(pdfWrap);
  pdfFrame.removeAttribute("src");

  show(top1); show(top2); show(top3);
  show(bot1Panel); show(bot2Panel); show(bot3Panel);

  setGridMode("three");

  setTopBtn(b1,"",null); setTopBtn(b2,"",null); setTopBtn(b3,"",null);

  cap1.textContent=""; cap2.textContent=""; cap3.textContent="";
  setBottomHTML(bot1slot,""); setBottomHTML(bot2slot,""); setBottomHTML(bot3slot,"");

  setImg(t1,""); setImg(t2,""); setImg(t3,"");
}

/* =========================
   PDF FIX
========================= */
function siteBase(){
  const u = new URL(window.location.href);
  u.hash = ""; u.search = "";
  const path = u.pathname.endsWith("/") ? u.pathname : u.pathname.replace(/\/[^\/]*$/, "/");
  return u.origin + path;
}
function pdfAbs(name){ return siteBase() + name + ".pdf"; }

async function resolvePdfViewer(){
  for(const p of PDFJS_VIEWER_CANDIDATES){
    try{
      const r = await fetch(p, { cache:"no-store" });
      if(r.ok){ PDFJS_VIEWER = p; return; }
    }catch(e){}
  }
  PDFJS_VIEWER = null;
}
resolvePdfViewer();

function pdfUrl(name){
  const file = pdfAbs(name);
  if(PDFJS_VIEWER){
    return PDFJS_VIEWER + "?file=" + encodeURIComponent(file) + "#pagemode=none";
  }
  return file;
}

function showPdf(name, onBack){
  clearT(); // sem timer em PDF

  hide(top1); hide(top2); hide(top3);
  show(pdfWrap);

  pdfFrame.src = pdfUrl(name);

  pdfBack.onclick = () => { hide(pdfWrap); onBack(); };
  pdfWhats.onclick = () => window.location.href = WHATS;
}

/* =========================
   RENDER ENGINE
========================= */
function renderScreen(screen){
  resetAll();
  setGridMode(screen.mode || "three");

  if(screen.type==="pdf"){
    // textos embaixo
    if(screen.bottom1) setBottomHTML(bot1slot, screen.bottom1);
    if(screen.bottom2) setBottomHTML(bot2slot, screen.bottom2);
    if(screen.bottom3) setBottomHTML(bot3slot, screen.bottom3);
    if(!screen.bottom2) hide(bot2Panel);

    showPdf(screen.pdfName, screen.onBack);
    return;
  }

  if(screen.hideTop1) hide(top1);
  if(screen.hideTop2) hide(top2);
  if(screen.hideTop3) hide(top3);

  if(screen.hideBot1) hide(bot1Panel);
  if(screen.hideBot2) hide(bot2Panel);
  if(screen.hideBot3) hide(bot3Panel);

  if(screen.img1) setImg(t1, img(screen.img1));
  if(screen.img2) setImg(t2, img(screen.img2));
  if(screen.img3) setImg(t3, img(screen.img3));

  // top buttons (continuar etc.)
  setTopBtn(b1, screen.topBtn1Label || "", screen.topBtn1Action || null);
  setTopBtn(b2, screen.topBtn2Label || "", screen.topBtn2Action || null);
  setTopBtn(b3, screen.topBtn3Label || "", screen.topBtn3Action || null);

  // bottom slots
  setBottomHTML(bot1slot, screen.bottom1 || "");
  setBottomHTML(bot2slot, screen.bottom2 || "");
  setBottomHTML(bot3slot, screen.bottom3 || "");

  if(typeof screen.bottomBtn1Action === "function") setBottomButton(bot1slot, screen.bottomBtn1Label, screen.bottomBtn1Action);
  if(typeof screen.bottomBtn2Action === "function") setBottomButton(bot2slot, screen.bottomBtn2Label, screen.bottomBtn2Action);
  if(typeof screen.bottomBtn3Action === "function") setBottomButton(bot3slot, screen.bottomBtn3Label, screen.bottomBtn3Action);

  // captions mobile
  cap1.innerHTML = screen.cap1 || screen.bottom1 || "";
  cap2.innerHTML = screen.cap2 || screen.bottom2 || "";
  cap3.innerHTML = screen.cap3 || screen.bottom3 || "";

  // timer
  if(screen.timer===false){
    clearT();
  }else if(typeof screen.onTimeout==="function"){
    startT(screen.onTimeout);
  }
}

/* =========================
   FLOW (EXATAMENTE COMO VOCÊ DEFINIU)
========================= */

/* INICIO */
function inicio(){
  renderScreen({
    mode:"two",
    hideTop2:true,
    hideBot2:true,
    img1:"01",
    img3:"02",
    bottom1:"<div class='bigLabel'>mulher</div>",
    bottom3:"<div class='bigLabel'>homem</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa01_q1,
    topBtn3Action: etapa02_q1,
    onTimeout: () => (Math.random()<0.5 ? etapa01_q1() : etapa02_q1())
  });
}

/* ===== ETAPA 01 ===== */
function etapa01_q1(){
  // ✅ imagem só no centro em cima, opções embaixo esquerda/direita
  renderScreen({
    mode:"three",
    hideTop1:true, hideTop3:true,
    img2:"0102",
    bottom2:"<div class='centerText'>Você vai aprofundar seu relacionamento comprando um anel?</div>",
    bottomBtn1Label:"sim",
    bottomBtn3Label:"não",
    bottomBtn1Action: etapa01_tipo,
    bottomBtn3Action: etapa01_nao_end,
    onTimeout: etapa01_nao_end
  });
}

function etapa01_nao_end(){
  renderScreen({
    mode:"center",
    img2:"0105",
    hideTop1:true, hideTop3:true,
    hideBot1:true, hideBot3:true,
    bottom2:"<div class='centerText'>ah que pena, desejo tudo de bom para o seu relacionamento então</div>",
    onTimeout: inicio
  });
}

function etapa01_tipo(){
  renderScreen({
    mode:"three",
    img1:"0401",
    img2:"0103",
    img3:"0301",
    bottom1:"<div class='bigLabel'>Loja Baratesa</div>",
    bottom2:"<div class='centerText'>Qual tipo de joalheria você escolheria?</div>",
    bottom3:"<div class='bigLabel'>Emporium24k</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa01_baratesa_q,
    topBtn3Action: etapa01_emporium_q,
    onTimeout: inicio
  });
}

function etapa01_emporium_q(){
  renderScreen({
    mode:"three",
    img2:"03",
    img1:"0103",
    img3:"0103",
    bottom2:"<div class='centerText'>Olá como posso te ajudar?</div>",
    bottom1:"<div class='bigLabel'>quero um par de anéis de namoro</div>",
    bottom3:"<div class='bigLabel'>quero um par de anéis de casamento</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa01_pdf_prata,
    topBtn3Action: etapa01_pdf_ouro,
    onTimeout: etapa01_tipo
  });
}

function etapa01_baratesa_q(){
  renderScreen({
    mode:"three",
    img2:"04",
    img1:"0103",
    img3:"0103",
    bottom2:"<div class='centerText'>Eai procurando um par de alianças no precinho?</div>",
    bottom1:"<div class='bigLabel'>sim</div>",
    bottom3:"<div class='bigLabel'>não</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa01_tapeada,
    topBtn3Action: etapa01_tipo,
    onTimeout: etapa01_tipo
  });
}

function etapa01_pdf_prata(){
  renderScreen({
    type:"pdf",
    pdfName:"Prata",
    bottom1:"<div class='bigLabel'>muito caro</div>",
    bottom3:"<div class='bigLabel'>quero comprar</div>",
    onBack: etapa01_tipo
  });
}
function etapa01_pdf_ouro(){
  renderScreen({
    type:"pdf",
    pdfName:"Ouro",
    bottom1:"<div class='bigLabel'>muito caro</div>",
    bottom3:"<div class='bigLabel'>quero comprar</div>",
    onBack: etapa01_tipo
  });
}

function etapa01_tapeada(){
  renderScreen({
    mode:"three",
    img2:"0108",
    img1:"0105",
    img3:"0106",
    bottom2:"<div class='centerText'>FUI TAPEADA</div>",
    bottom1:"<div class='bigLabel'>Desistir</div>",
    bottom3:"<div class='bigLabel'>voltar na loja barateza</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: inicio,
    topBtn3Action: etapa01_aviso,
    onTimeout: inicio
  });
}

function etapa01_aviso(){
  renderScreen({
    mode:"three",
    img2:"0402",
    img1:"0106",
    img3:"0105",
    bottom2:"<div class='centerText'>VOCÊ ACHA MESMO QUE UM ANEL NESSE PREÇO É DE ALTA QUALIDADE? VOCÊ NÃO TEM GARANTIA</div>",
    bottom1:"<div class='bigLabel'>LUTAR</div>",
    bottom3:"<div class='bigLabel'>Desistir</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa01_luta1,
    topBtn3Action: inicio,
    onTimeout: inicio
  });
}

function etapa01_luta1(){
  renderScreen({
    mode:"center",
    img2:"0403",
    hideTop1:true, hideTop3:true,
    hideBot1:true, hideBot3:true,
    topBtn2Label:"continuar",
    topBtn2Action: etapa01_luta2,
    onTimeout: etapa01_luta2
  });
}

function etapa01_luta2(){
  renderScreen({
    mode:"center",
    img2:"0107",
    hideTop1:true, hideTop3:true,
    hideBot1:true, hideBot3:true,
    topBtn2Label:"continuar",
    topBtn2Action: inicio,
    onTimeout: inicio
  });
}

/* ===== ETAPA 02 ===== */
function etapa02_q1(){
  renderScreen({
    mode:"three",
    hideTop1:true, hideTop3:true,
    img2:"0202",
    bottom2:"<div class='centerText'>Você vai aprofundar seu relacionamento comprando um anel?</div>",
    bottomBtn1Label:"sim",
    bottomBtn3Label:"não",
    bottomBtn1Action: etapa02_tipo,
    bottomBtn3Action: etapa02_nao_end,
    onTimeout: etapa02_nao_end
  });
}

function etapa02_nao_end(){
  renderScreen({
    mode:"center",
    img2:"0205",
    hideTop1:true, hideTop3:true,
    hideBot1:true, hideBot3:true,
    bottom2:"<div class='centerText'>ah que pena, desejo tudo de bom para o seu relacionamento então</div>",
    onTimeout: inicio
  });
}

function etapa02_tipo(){
  renderScreen({
    mode:"three",
    img1:"0401",
    img2:"0203",
    img3:"0301",
    bottom1:"<div class='bigLabel'>Loja Baratesa</div>",
    bottom2:"<div class='centerText'>Qual tipo de joalheria você escolheria?</div>",
    bottom3:"<div class='bigLabel'>Emporium24k</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa02_baratesa_q,
    topBtn3Action: etapa02_emporium_q,
    onTimeout: inicio
  });
}

function etapa02_emporium_q(){
  renderScreen({
    mode:"three",
    img2:"03",
    img1:"0203",
    img3:"0203",
    bottom2:"<div class='centerText'>Olá como posso te ajudar?</div>",
    bottom1:"<div class='bigLabel'>quero um par de anéis de namoro</div>",
    bottom3:"<div class='bigLabel'>quero um par de anéis de casamento</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa02_pdf_prata,
    topBtn3Action: etapa02_pdf_ouro,
    onTimeout: etapa02_tipo
  });
}

function etapa02_baratesa_q(){
  renderScreen({
    mode:"three",
    img2:"04",
    img1:"0203",
    img3:"0203",
    bottom2:"<div class='centerText'>Eai procurando um par de alianças no precinho?</div>",
    bottom1:"<div class='bigLabel'>sim</div>",
    bottom3:"<div class='bigLabel'>não</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa02_tapeado,
    topBtn3Action: etapa02_tipo,
    onTimeout: etapa02_tipo
  });
}

function etapa02_pdf_prata(){
  renderScreen({
    type:"pdf",
    pdfName:"Prata",
    bottom1:"<div class='bigLabel'>muito caro</div>",
    bottom3:"<div class='bigLabel'>quero comprar</div>",
    onBack: etapa02_tipo
  });
}
function etapa02_pdf_ouro(){
  renderScreen({
    type:"pdf",
    pdfName:"Ouro",
    bottom1:"<div class='bigLabel'>muito caro</div>",
    bottom3:"<div class='bigLabel'>quero comprar</div>",
    onBack: etapa02_tipo
  });
}

function etapa02_tapeado(){
  renderScreen({
    mode:"three",
    img2:"0208",
    img1:"0205",
    img3:"0206",
    bottom2:"<div class='centerText'>FUI TAPEADO</div>",
    bottom1:"<div class='bigLabel'>Desistir</div>",
    bottom3:"<div class='bigLabel'>voltar na loja barateza</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: inicio,
    topBtn3Action: etapa02_aviso,
    onTimeout: inicio
  });
}

function etapa02_aviso(){
  renderScreen({
    mode:"three",
    img2:"0402",
    img1:"0206",
    img3:"0205",
    bottom2:"<div class='centerText'>VOCÊ ACHA MESMO QUE UM ANEL NESSE PREÇO É DE ALTA QUALIDADE? VOCÊ NÃO TEM GARANTIA</div>",
    bottom1:"<div class='bigLabel'>LUTAR</div>",
    bottom3:"<div class='bigLabel'>Desistir</div>",
    topBtn1Label:"continuar",
    topBtn3Label:"continuar",
    topBtn1Action: etapa02_luta1,
    topBtn3Action: inicio,
    onTimeout: inicio
  });
}

function etapa02_luta1(){
  renderScreen({
    mode:"center",
    img2:"0403",
    hideTop1:true, hideTop3:true,
    hideBot1:true, hideBot3:true,
    topBtn2Label:"continuar",
    topBtn2Action: etapa02_luta2,
    onTimeout: etapa02_luta2
  });
}

function etapa02_luta2(){
  renderScreen({
    mode:"center",
    img2:"0207",
    hideTop1:true, hideTop3:true,
    hideBot1:true, hideBot3:true,
    topBtn2Label:"continuar",
    topBtn2Action: inicio,
    onTimeout: inicio
  });
}

/* START */
inicio();
</script>
</body>
</html>
